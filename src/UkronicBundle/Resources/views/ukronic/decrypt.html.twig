{% extends 'UkronicBundle::layout.html.twig' %}

{% block content %}
	<div class="container">

		{{ form_start(form) }}
		
		<div class="row">
			
			<div class="col-md-2"><img src="{{ movie.posterURL }}" alt="le film" width= 100px height= 100px></div>
			<div class="col-md-5">
				<p> {{ movie.title }} </p>

				<p>Ma note</p>
				<p>Niveau d'ambiguité</p>
				<p>Je pense avoir compris</p>
				
			</div>
			<div class="col-md-3">
				Notes
				{# trois rangées d'étoiles #}
				{# Note du film #}
				{# Etoiles niveau ambiguité #}
				{# Etoiles je pense avoir compris #}
				
				<table>
					{% for i in 1..3 %}
						{% if i  == 1 %}
								
						<tr class="prefered">
							<th>Ma note</th>
						{% elseif i == 2 %}		
						<tr class="nocomprendo">
							<th>Niveau Ambiguité</th>
						{% else %}		
						<tr class="baleze">
							<th>Compréhension</th>
						{% endif %}
							
							{% for j in 1..10 %}
								<td>
							    <img src="{{ asset("fleche_creuse.png") }}" alt="étoile" class="star">
								</td>
							{% endfor %}

						</tr>  
					{% endfor %}
					
				</table>
				    
				
			</div>

		</div>

		<div>
			{# le titre #}
			<div class="row">
				<div class="col-md-12">
					<p>{{ form_label(form.typeDecrypt) }}</p>
					{{ form_widget(form.typeDecrypt) }}
					<p>{{ form_label(form.title) }}</p>
					{{ form_widget(form.title) }}
				</div>
			</div>
		</div>

		<div>
			{# le corps de la critique #}
			<div class="row">
				<div class="col-md-12">
					{# formulaire pour le corps de la critique #}
					<p>{{ form_label(form.content) }}</p>
					{{ form_widget(form.content) }}
					
				</div>
			</div>
		</div>
		<div>
			{# bouton validation #}
			{{ form_rest(form) }}
			
			{{ form_end(form) }} 
		</div>
	</div>
    
{% endblock %}

{% block javascripts %}

	{{ parent() }}
	<script>
	$(function(){
		var prefered = $('input.prefered').val();
		
		var nocomprendo = $('input.nocomprendo').val();
		
		var baleze = $('input.baleze').val();
		

		// on remplit l'affichage si une ancienne note existe
		if (prefered > 0) {
			var preferedTd = $('tr.prefered').find('td')[prefered - 1];
			$(preferedTd).find('img').attr("src","{{ asset("fleche_pleine.png") }}");
			$(preferedTd).prevAll().find('img').attr("src","{{ asset("fleche_pleine.png") }}");
		}

		if (nocomprendo > 0) {
			var nocomprendoTd = $('tr.nocomprendo').find('td')[nocomprendo - 1];
			$(nocomprendoTd).find('img').attr("src","{{ asset("fleche_pleine.png") }}");
			$(nocomprendoTd).prevAll().find('img').attr("src","{{ asset("fleche_pleine.png") }}");
		}

		if (baleze > 0) {
			var balezeTd = $('tr.baleze').find('td')[baleze - 1];
			$(balezeTd).find('img').attr("src","{{ asset("fleche_pleine.png") }}");
			$(balezeTd).prevAll().find('img').attr("src","{{ asset("fleche_pleine.png") }}");
		}
		// en cas de clic sur une étoile on met à jour l'affichage sur une ligne
		$('.star').click(function(){
			
			$(this).attr("src","{{ asset("fleche_pleine.png") }}");
			$(this).parent().prevAll().find('img').attr("src","{{ asset("fleche_pleine.png") }}");
			$(this).parent().nextAll().find('img').attr("src","{{ asset("fleche_creuse.png") }}");
			var classSelected = $(this).parent().parent().attr('class');
			
			
			var myLeft = $(this).parent().prevAll().length; // position de l'étoile cliquée sur la ligne
			$('input.'+classSelected).val(myLeft); // on met la valeur dans le champ
			
			
		});
	});
	</script>
    
{% endblock %}